#################################################################################
# Licensed to the .NET Foundation under one or more agreements.                 #
# The .NET Foundation licenses this file to you under the MIT license.          #
# See the LICENSE file in the project root for more information.                #
#################################################################################
trigger:
  branches:
    include:
    - internal/main
  paths:
    include:
    - src
    - eng
    - tools
    - .config
    - build.proj
    - Nuget.config
    - '*.cmd'
    - '*.sh'

parameters: # parameters are shown up in ADO UI in a build queue time
- name: 'debug'
  displayName: 'Enable debug output'
  type: boolean
  default: false

- name: targetFrameworks
  displayName: 'Target Frameworks on Windows'
  type: object
  default: [net462, net8.0]

- name: targetFrameworksLinux
  displayName: 'Target Frameworks on Non-Windows'
  type: object
  default: [net8.0]

- name: netcoreVersionTestUtils
  displayName: 'Netcore Version for Test Utilities'
  type: object
  default: net8.0

- name: buildPlatforms
  displayName: 'Build Platforms on Windows'
  type: object
  default: [AnyCPU]

- name: testSets
  displayName: 'Test Sets'
  type: object
  default: [1, 2, 3]

- name: useManagedSNI
  displayName: |
    Use Managed/Native SNI on Windows,
    values [false, true], [false] or [true] are allowed
  type: object
  default: [false, true]

- name: codeCovTargetFrameworks
  displayName: 'Code Coverage Target Frameworks'
  type: object
  default: [net462, net8.0]

- name: buildType
  displayName: 'Build Type'
  default: Project
  values:
    - Project
    - Package

- name: defaultPoolName
  type: string
  default: $(ci_var_defaultPoolName)

variables:
  - template: libraries/ci-build-variables.yml@self

  - name: artifactName
    value: Artifacts

  - name: defaultHostedPoolName
    value: 'Azure Pipelines'

stages:
  - stage: build_nugets
    displayName: 'Build NuGet Packages'
    jobs:
    - template: common/templates/jobs/ci-build-nugets-job.yml@self
      parameters:
        artifactName: $(artifactName)
